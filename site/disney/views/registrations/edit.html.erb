<%= render partial: "/application/user_bar" %>

<div class="container">
  <%= render partial: "profile/profile_header" %>
  <%= render partial: "profile/profile_navbar", locals: { page: "edit" } %>
  <%= form_for(resource, :as => resource_name, :url => registration_path(resource_name), :html => { :method => :put, :multipart => true }) do |f| %>
    <div class="row" style="margin-top: 1.5em;">
      <div class="col-md-12">
        <div class="panel panel-default">
          <div class="panel-heading profile-heading">
            
          </div>
          <div class="panel-body profile-body">
            

              <div class="row">
                <div class="col-md-12">
                  <% if resource.errors.any? %>
                    <div class="row">
                      <div class="col-lg-12">
                        <div class="alert alert-danger">
                          <p>Errori nel salvataggio dell'utente:</p>
                          <p>
                            <ul>
                              <% resource.errors.full_messages.each do |msg| %>
                                <li><%= msg %></li>
                              <% end %>
                            </ul>
                          </p>
                        </div>
                      </div>
                    </div>
                  <% elsif flash[:notice] %>
                    <div class="row">
                      <div class="col-lg-12">
                        <div class="alert alert-success"><%= flash[:notice] %></div>
                      </div>
                    </div>
                  <% end %>
                </div>
              </div>

              <div class="row">
                <%= f.hidden_field :avatar_selected %>
                <div class="col-xs-12">
                	
                  <div class="form-group">
	                <label for="username" class="col-xs-3 control-label text-right">Nickname</label>
	                <div class="col-xs-9">
	                  <%= f.text_field :username, :class => "form-control" %>
	                </div>
	              </div>
                	
                  <div class="row">
                    <div class="col-sm-4 text-center">
                      <div class="fileinput fileinput-new" data-provides="fileinput">
                          <div class="fileinput-new thumbnail" style="width: 150px; height: 115px;">
                            <img src="<%= current_user.avatar %>">
                          </div>
                          <div class="fileinput-preview fileinput-exists thumbnail" style="width: 150px; height: 115px;"></div>
                          <span class="btn btn-default btn btn-xs btn-file btn-block" style="vertical-align: top;"><span class="fileinput-new">Cambia immagine</span><span class="fileinput-exists">Modifica</span><%= f.file_field :avatar %></span>
                      </div>
                    </div>
                    <div class="col-sm-3"></div>
                    <div class="col-sm-5">
                      <div class="list-group">
                        <a id="upload-avatar" href="javascript: void(0)" onclick="updateAvatar('upload')" class="list-group-item <%= "active" if current_user.avatar_selected == "upload" %> avatar"><img src="<%= current_user.avatar(:thumb) %>" alt="..." class="img-circle img-profile" width="10%">&nbsp;&nbsp;&nbsp;Immagine caricata</a>
                        <% if (auth = current_user.authentications.find_by_provider("twitter")) %>
                          <a id="twitter-avatar" href="javascript: void(0)" onclick="updateAvatar('twitter')" class="list-group-item <%= "active" if current_user.avatar_selected == "twitter" %> avatar btn-tt"><img src="<%= auth.avatar %>" alt="..." class="img-circle img-profile" width="10%">&nbsp;&nbsp;&nbsp;Immagine Twitter</a>
                        <% end %>
                        <% if (auth = current_user.authentications.find_by_provider("facebook")) %>
                          <a id="facebook-avatar" href="javascript: void(0)" onclick="updateAvatar('facebook')" class="list-group-item <%= "active" if current_user.avatar_selected == "facebook" %> avatar"><img src="<%= auth.avatar %>" alt="..." class="img-circle img-profile" width="10%">&nbsp;&nbsp;&nbsp;Immagine Facebook</a>
                        <% end %>
                      </div>
                    </div>
                  </div>
                  
                  
                </div>
              </div>
          </div>
          <div class="panel-footer text-right">
            <button class="btn btn-primary">Salva</button>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>

<div class="container-fluid">
  <%= render partial: "/application/footer" %>
</div>


<script type="text/javascript">

  function updateAvatar(type) {
    $("#user_avatar_selected").val(type);
    $(".avatar").removeClass("active");
    $("#" + type + "-avatar").addClass("active");
  }

</script>
 

