<div class="container-fluid">
  <%= render partial: "/application/user_bar" %>
  <div class="container">
    <div class="row">
      <div class="col-md-12 cta">
        <div class="panel panel-default cta-page">
          <div class="panel-heading">
            <div class="row ">
              <div class="col-md-12">                      
                <h3 class="text-muted">Entra in Fandom</h3>
              </div>
              
            </div>
          </div>
          <div class="panel-body">
            <div class="row">      
              <div class="col-md-6">
                <h4 class="lead">Registrati </h4>
                <%= form_for resource, :url => "/users/rai/sign_up/create" do |f| %> 
                  <% if resource.errors.any? %>
                    <div style="margin-top: 10px; margin-bottom: 10px; margin-left: -20px;">
                      <ul>
                        <p style="font-size: 15px;">Errori nella compilazione del modulo:</p>
                        <% resource.errors.full_messages.each do |error_message| %>
                            <li><%= error_message %></li>
                        <% end %>
                      </ul>
                    </div>
                  <% end %>
                  <div class="form-group text-left">
                    <!--<label for="exampleInputEmail1">Email address</label>-->
                    <%= f.text_field :username, :class => "form-control", :placeholder => "Username" %>
                  </div>
                  <div class="form-group text-left">
                    <!--<label for="exampleInputEmail1">Email address</label>-->
                    <%= f.text_field :first_name, :class => "form-control", :placeholder => "Nome" %>
                  </div>
                  <div class="form-group text-left">
                    <!--<label for="exampleInputPassword1">Password</label>-->
                    <%= f.text_field :last_name, :class => "form-control", :placeholder => "Cognome" %>
                  </div>
                  <div class="form-group text-left">
                    <!--<label for="exampleInputEmail1">Email address</label>-->
                    <%= f.text_field :email, :class => "form-control", :placeholder => "Email" %>
                  </div>
                  <div class="form-group text-left">
                    <!--<label for="exampleInputPassword1">Password</label>-->
                    <%= f.password_field :password, :class => "form-control", :placeholder => "Password" %>
                  </div>
                  <button type="submit" class="btn btn-info btn-lg btn-block">Registrati</button>
                  <div class="checkbox text-left">
                    
                  </div>
                <% end %>
                <p>&nbsp;</p>
              </div>
              <%= form_for resource, :url => "/users/rai/sign_in/create" do |f| %>
                <div class="col-md-6">
                  <h4 class="lead text-left">Login</h4>
                  <p><%= flash[:alert] %></p>
                  <div class="form-group text-left">
                    <!--<label for="exampleInputEmail1">Email address</label>-->
                    <%= f.text_field :username, :class => "form-control", :placeholder => "Username" %>
                  </div>
                  <div class="form-group text-left">
                    <!--<label for="exampleInputPassword1">Password</label>-->
                    <%= f.password_field :password, :class => "form-control", :placeholder => "Password" %>
                  </div>
                  <button type="submit" class="btn btn-info btn-lg btn-block">Login</button>
                  <div class="checkbox text-left">
                    <label> <input type="checkbox" name="user[remember_me]" value="1" /> Ricordati di me</label>
                  </div>
                  <p>Dimenticato la Password? <br/><a href="http://www.rai.tv/dl/RaiTV/MyRaiTV/iscrizione.html#PasswordRecovery" target="_top">ricevine una nuova</a></p>
                  <hr>
                  <p class="text-center">Oppure entra con:</p>
                  <div class="facebook-connect">

                  <button type="button" class="btn btn-fb btn-md btn-block" onclick="gigyaSocializeLogin('facebook')">Signin with Facebook</button>
                  <a class="btn btn-tw btn-md btn-block" onclick="gigyaSocializeLogin('twitter')">Signin with Twitter</a>
                  <!--<button type="button" class="btn btn-g btn-md btn-block">Signin with Google+</button>-->
                    
                  <p>&nbsp;</p>
                </div>
              <% end %>  
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<script type="text/javascript">

  function gigyaSocializeLogin(provider) {
    gigya.socialize.login({
      provider: provider,
      callback: function (loginResult) {
        gigya.socialize.getUserInfo({
          callback: function (getUserInfoResult) {
            loginSocialBallando(getUserInfoResult); 
          }
        });
      }
    });
  }

  function loginSocialBallando(getUserInfoResult) {
    $.ajax({
      type: "POST", // TODO: get or post?
      url: "http://www.rai.tv/MyRaiTv/loginSocialBallando.do",
      data: { userObject: JSON.stringify(getUserInfoResult) },
      success: function(data) {
        generateUserFromProvider(data);
      }
    });
  }

  function generateUserFromProvider(user) {
    $.ajax({
      type: "POST", // TODO: get or post?
      url: "/users/rai/sign_in_from_provider/create",
      data: { user: user },
      success: function(data) {
        window.location.replace("/");
      }
    });
  }

</script>

