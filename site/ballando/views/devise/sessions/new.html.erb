<div class="container-fluid">

  <div class="container">
    <div class="row">
      <div class="col-md-6 col-md-offset-3 cta">
        <div class="panel panel-default cta-page">
          <div class="panel-heading">
            <div class="row ">
              <div class="col-md-12">                      
                <h3 class="text-muted">Entra in Fandom</h3>
              </div>
              
            </div>
          </div>
          <div class="panel-body">
            <div class="row">      
              <%= form_for resource, :url => "/users/rai/sign_in/create" do |f| %>
                <div class="col-md-12">
                  <h4 class="lead text-left">Login</h4>
                  <p id="form-errors"><%= flash[:error] %></p>
                  <div class="form-group text-left">
                    <!--<label for="exampleInputEmail1">Email address</label>-->
                    <%= f.text_field :username, :class => "form-control", :placeholder => "Username" %>
                  </div>
                  <div class="form-group text-left">
                    <!--<label for="exampleInputPassword1">Password</label>-->
                    <%= f.password_field :password, :class => "form-control", :placeholder => "Password" %>
                  </div>
                  <button type="submit" class="btn btn-info btn-lg btn-block">Login</button>

                  <p>Dimenticato la Password? <br/><a href="http://www.rai.tv/dl/RaiTV/MyRaiTV/iscrizione.html#PasswordRecovery" target="_blank">ricevine una nuova</a></p>

                  <p class="text-center">Oppure:</p>
                  <div class="facebook-connect">
  
                  <button type="button" class="btn btn-fb btn-md btn-block" onclick="gigyaSocializeLogin('facebook')">Signin with Facebook</button>
                  <a class="btn btn-tw btn-md btn-block" onclick="gigyaSocializeLogin('twitter')">Signin with Twitter</a>
                  <!--<button type="button" class="btn btn-g btn-md btn-block">Signin with Google+</button>-->
                    
                  </div>

                  <p>&nbsp;</p>
                </div>
              <% end %>  
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<script type="text/javascript">

  function gigyaSocializeLogin(provider) {
    gigya.socialize.login({
      provider: provider,
      callback: function (loginResult) {
        gigya.socialize.getUserInfo({
          callback: function (getUserInfoResult) {
            loginSocialBallando(getUserInfoResult); 
          }
        });
      }
    });
  }

  function loginSocialBallando(getUserInfoResult) {
    $.ajax({
      type: "POST",
      url: "http://www.rai.tv/MyRaiTv/loginSocialBallando.do",
      data: { userObject: JSON.stringify(getUserInfoResult) },
      success: function(data) {
        generateUserFromProvider(data);
      }
    });
  }

  function generateUserFromProvider(user) {
    $.ajax({
      type: "POST",
      url: "/users/rai/sign_in_from_provider/create",
      data: { user: user },
      success: function(data) {
        window.location.replace("/");
      }
    });
  }

</script>
