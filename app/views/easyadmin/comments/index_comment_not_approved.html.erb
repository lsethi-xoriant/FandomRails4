<%= render partial: "/easyadmin/easyadmin/left_bar", locals: { page: "comment" } %>
 
  <div id="content">    
    
    <div id="content-header">
      <h1><%= "Property #{ @current_prop.name }" if @current_prop %></h1>
    </div> <!-- #content-header --> 


    <div id="content-container">

	<ul class="nav nav-tabs">
	  <li><a href="/easyadmin/comments/to_approved">Commenti da approvare</a></li>
	  <li ><a href="/easyadmin/comments/approved">Commenti pubblicati</a></li>
	  <li class="active"><a href="/easyadmin/comments/not_approved">Commenti oscurati</a></li>
	</ul>

    <h3>Commenti oscurati</h3>
    <hr/>

    <div class="row">
    	<div class="col-md-2">
          	<%= form_tag :method => 'post' do %>
          	<div class="form-group">
              <label class="text-input">Filtra per ID CallTo Action</label></br>
              	<%= text_field_tag :id_cta_not_approved_filter, @id_cta_not_approved_filter %>
            </div>
          </div>
          <div class="col-md-1">
          	<div class="form-group">
                </br><%= submit_tag 'Filtra', class: 'btn btn-primary' %>
            </div>
          </div>
          <div class="col-md-1">
          	<div class="form-group">
                </br><%= submit_tag 'Reset', class: 'btn btn-primary' %>
		  	    <% end %>
            </div>
          </div>
         </div>
		<div class="col-md-12"> 
			<table class="table table-striped">
				<thead>
					<tr>
						<th>Utente</th>
						<th>Call to action</th>
						<th>Testo</th>
						<th>Scritto il</th>
						<th>Azioni</th>
					</tr>
				</thead>
				<% @comment_not_approved.each do |c| %>
					<tr id="comment-<%= c.id %>-tr">
						<td><%= c.user ? c.user.id : "Anonimo" %></td>
						<td><%= link_to "CTA", easyadmin_cta_show_path(Interaction.select(:call_to_action_id).where(:resource_id => c.comment_id, :resource_type => 'Comment').first.call_to_action_id), class: "btn btn-primary btn-xs" %></a></td>
						<td><%= c.text %></td>
						<td><%= c.created_at %></td>
						<td id="comment-<%= c.id %>">
							<button type="button" class="btn btn-default btn-xs" onclick="updateComment(true, <%= c.id %>)">Pubblica</button>					
						</td>
					</tr>
				<% end %>
			</table>
		</div>

	<div class="row cta-to-show">
		<div class="col-md-12">
			<%= render partial: "/easyadmin/easyadmin/pagination" %>
		</div>
	</div>

  </div>
</div>

<script type="text/javascript">
	function updateComment(approved, comment_id) {
		$.ajax({
            type: "POST",
            url: "/easyadmin/comments/" + comment_id + "/update_comment_status",
            data: { "approved": approved },
            beforeSend: function(jqXHR, settings) {
                jqXHR.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'));
            },
            success: function(data) {
            	$("#comment-" + comment_id + "-tr").remove();
            }
        });
	}
</script>
