<%= render partial: "/easyadmin/easyadmin/left_bar", locals: { page: "comment" } %>
 
  <div id="content">    
    
    <div id="content-header">
      <h1><%= "Property #{ @current_prop.name }" if @current_prop %></h1>
    </div> <!-- #content-header --> 


    <div id="content-container">

	<ul class="nav nav-tabs">
	  <li class="active"><a href="/easyadmin/comments/to_approved">Commenti da approvare</a></li>
	  <li ><a href="/easyadmin/comments/approved">Commenti pubblicati</a></li>
	  <li><a href="/easyadmin/comments/not_approved">Commenti oscurati</a></li>
	</ul>

    <h3>Commenti da approvare</h3>
    <hr/>

    <div class="row">
		<div class="col-md-12"> 
			<table class="table table-striped">
				<thead>
					<tr>
						<th>Utente</th>
						<th>Testo</th>
						<th>Scritto il</th>
						<th>Azioni</th>
					</tr>
				</thead>
				<% @comment_to_be_approved.each do |c| %>
					<tr>
						<td><%= c.user ? c.user.id : "Anonimo" %></td>
						<td><%= c.text %></td>
						<td><%= c.created_at %></td>
						<td id="comment-<%= c.id %>">
							<button type="button" class="btn btn-default btn-xs" onclick="updateComment('pub', <%= c.id %>)">Pubblica</button>
							&nbsp;&nbsp;
							<button type="button" class="btn btn-warning btn-xs" onclick="updateComment('hide', <%= c.id %>)">Nascondi</button>							
						</td>
					</tr>
				<% end %>
			</table>
		</div>
	</div>

	<div class="row cta-to-show">
		<div class="col-md-12">
			<%= render partial: "/easyadmin/easyadmin/pagination" %>
		</div>
	</div>

  </div>
</div>

<script type="text/javascript">
	function updateComment(pub_or_hide, comment_id) {
		$.ajax({
            type: "POST",
            url: "/easyadmin/comments/" + comment_id + "/update_comment_status",
            data: { "pub_or_hide": pub_or_hide },
            beforeSend: function(jqXHR, settings) {
                jqXHR.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'));
            },
            success: function(data) {
            	$("#comment-" + comment_id).html(pub_or_hide);
            }
        });
	}
</script>
