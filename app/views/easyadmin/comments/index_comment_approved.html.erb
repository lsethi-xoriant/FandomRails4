<%= render partial: "/easyadmin/easyadmin/left_bar", locals: { page: "comment" } %>
 
  <div id="content">    
    
    <div id="content-header">
      <h1><%= "Property #{ @current_prop.name }" if @current_prop %></h1>
    </div> <!-- #content-header --> 


    <div id="content-container">

  <ul class="nav nav-tabs">
    <li><a href="/easyadmin/comments/to_approved">Commenti da approvare</a></li>
    <li class="active"><a href="/easyadmin/comments/approved">Commenti pubblicati</a></li>
    <li><a href="/easyadmin/comments/not_approved">Commenti oscurati</a></li>
  </ul>

    <h3>Commenti approvati</h3>
    <hr/>

    <div class="row">
      <div class="col-md-2">
            <%= form_tag :method => 'post' do %>
            <div class="form-group">
              <label class="text-input">Filtra per ID CallTo Action</label></br>
                <%= text_field_tag :id_cta_approved_filter, @id_cta_approved_filter, :class => 'form-control' %>
            </div>
          </div>
          <div class="col-md-2">
            <div class="form-group">
                </br><%= submit_tag 'APPLICA FILTRO', class: 'btn btn-primary' %>
            </div>
          </div>
          <div class="col-md-2">
            <div class="form-group">
                </br><%= submit_tag 'RESET', class: 'btn btn-primary' %>
            <% end %>
            </div>
          </div>
         </div>
    <div class="col-md-12"> 
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Utente</th>
            <th>CTA</th>
            <th>Testo</th>
            <th>Scritto il</th>
            <th>Azioni</th>
          </tr>
        </thead>
        <% @comment_approved.each do |c| %>
          <tr id="comment-<%= c.id %>-tr">
            <td class="col-md-1"><%= c.user ? c.user.id : "Anonimo" %></td>
            <td class="col-md-1"><%= link_to "CTA", easyadmin_cta_show_path(Interaction.where(:resource_id => c.comment_id, :resource_type => 'Comment').first.call_to_action_id), class: "btn btn-primary btn-xs" %></a></td>
            <td class="col-md-6"><%= c.text %></td>
            <td class="col-md-2"><%= c.created_at %></td>
            <td id="comment-<%= c.id %>" class="col-md-3">
              <button type="button" class="btn btn-warning btn-xs" onclick="updateComment('hide', <%= c.id %>)">Nascondi</button>             
            </td>
          </tr>
        <% end %>
      </table>
    </div>

  <div class="row cta-to-show">
    <div class="col-md-12">
      <%= render partial: "/easyadmin/easyadmin/pagination" %>
    </div>
  </div>

  </div>
</div>

<script type="text/javascript">
  function updateComment(approved, comment_id) {
    $("#comment-" + comment_id + "-tr").remove();
    $.ajax({
            type: "POST",
            url: "/easyadmin/comments/" + comment_id + "/update_comment_status",
            data: { "approved": approved },
            beforeSend: function(jqXHR, settings) {
                jqXHR.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'));
            },
            success: function(data) {
              $("#comment-" + comment_id + "-tr").remove();
            }
        });
  }
</script>
