<%= render partial: "/easyadmin/easyadmin/left_bar", locals: { page: "user" } %>
 
  <div id="content">    
    
    <div id="content-header">
      <h1>Elenco UTENTI</h1>
    </div> <!-- #content-header --> 

    	<div id="content-container">

    	<% if flash[:notice] %>
	    	<div class="row">
		      <div class="col-md-12">         
		          <div class="row">
		            <div class="col-lg-12">
		              <div class="alert alert-success"><%= flash[:notice] %></div>
		            </div>
		          </div>
		        
		      </div>
		    </div>
	    <% end %>
	    
	  	<div class="row text-right">
	    	<div class="col-md-12">
	    		<a href="/easyadmin/export_users"><button type="button" class="btn btn-primary">ESPORTA CSV</button></a>
	    	</div>
	    </div>

      <div class="row">
        <div class="col-md-3">
          <label>Filtra per EMAIL</label><input class="form-control" type="text" onkeyup="updateFilter(this);">
        </div>
      </div>

      <div id="users-to-filter" class="row hidden">
        <div class="col-md-12"> 
          <table id="users-from-ajax-request" class="table table-striped">
          </table>
        </div>
      </div>

		<div class="row users-to-show">
			<div class="col-md-12"> 
				<table class="table table-striped">
					<thead>
						<tr>
							<th>Nome</th>
							<th>Username</th>
							<th>Email</th>
							<th>Città</th>
							<th>Azioni</th>
						</tr>
					</thead>
					<% @user_list.each do |user| %>
						<%= render partial: "/easyadmin/easyadmin/users_index_row", locals: { user: user } %>
					<% end %>
				</table>
			</div>
		</div>

		<div class="row">
			<div class="col-md-8">
				<%= render partial: "pagination" %>
			</div>
		</div>

	</div>
</div>

<script type="text/javascript">

  var ajax_in_progress = false;
  var filterString = "";

  function updateFilter(filter) {
    filterString = $(filter).val();
    updateUsersToFilter(filterString);
  }

  function updateUsersToFilter(filterString) {
    if(filterString == "") {

      $(".users-to-show").removeClass("hidden");
      $("#users-to-filter").addClass("hidden");

    } else {

      $(".users-to-show").addClass("hidden");
      $("#users-to-filter").removeClass("hidden");

        if(!ajax_in_progress) {

        ajax_in_progress = true;

        $.ajax({
              type: "GET",
              url: "user/filter/" + filterString,
              beforeSend: function(jqXHR, settings) {
                  jqXHR.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'));
              },
              success: function(data) {

                $("#users-from-ajax-request").html("");

                $("#users-from-ajax-request").html(data);

                html =
                      "<thead>" +
                        "<tr>" +
                          "<th>Nome</th>" +
                          "<th>Username</th>" +
                          "<th>Email</th>" +
                          "<th>Città</th>" +
                          "<th>Azioni</th>" +
                        "</tr>" +
                      "</thead>";

                $("#users-from-ajax-request").prepend(html);

                ajax_in_progress = false;

              },
              error: function(data) {
                ajax_in_progress = false;
              }
          });
        }
        else
          updateUsersToFilter(filterString);
    }
  }

</script>