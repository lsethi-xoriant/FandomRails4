<%= render partial: "/easyadmin/easyadmin/left_bar", locals: { page: "contest" } %>
    
<div id="content">    

  <div id="content-header">
    <h1>NUOVA CALLTOACTION</h1>
  </div> <!-- #content-header --> 

  <div id="content-container">

    <div class="row">
      <div class="col-md-12"> 
        <% if @prize.errors.any? %>
          <div class="row">
            <div class="col-lg-12">
              <div class="alert alert-danger">
                <p>Errori nel salvataggio dell'utente:</p>
                <p>
                  <ul>
                    <% @cta.errors.full_messages.each do |msg| %>
                      <li><%= msg %></li>
                    <% end %>
                  </ul>
                </p>
              </div>
            </div>
          </div>
        <% elsif flash[:notice] %>
          <div class="row">
            <div class="col-lg-12">
              <div class="alert alert-success"><%= flash[:notice] %></div>
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <h3>Dati generali</h3>
    <hr/>
    
    <%= form_for @prize, url: { action: "save_prize" }, multipart: true do |f| %>
      <div class="row">
        <div class="col-lg-6">
          <div class="form-group">
              <label class="text-input">Titolo</label>
              <%= f.text_field :title, :class => "form-control" %>
          </div>
          <div class="form-group">
              <label class="text-input">Contest di appartenenza</label>
              <% date_array = ContestPeriodicity.all.map { |cp| ["#{cp.contest.title} - #{cp.title}", cp.id] } %>
              <%# date_array.unshift ["", ""] %>
              <%= f.select(:contest_periodicity_id, date_array, {}, { :class => "form-control" }) %>
          </div>
          <div class="form-group">
              <label class="text-input">Descrizione</label>
              <%= f.text_area :description, :class => "form-control" %>
          </div>
          <!-- TODO
          <div class="form-group">
            <label>Abilita condivisione:</label>
            <div class="form-group">
              <label class="checkbox-inline"><%= check_box_tag 'fb_share' %>Facebook</label>
              <label class="checkbox-inline"><%= check_box_tag 'tt_share' %>Twitter</label>
              <label class="checkbox-inline"><%= check_box_tag 'mail_share' %>Email</label>
            </div>
          </div>
          -->
        </div>

        <div class="col-lg-6 text-center">
          <div class="form-group">
              <label class="text-input">Immagine premio</label>
              <div class="fileupload fileupload-new" data-provides="fileupload">
                <div class="fileupload-preview thumbnail" style="width: 400px; height: 200px; line-height: 20px;"></div>
                <div>
                  <span class="btn btn-default btn-file"><span class="fileupload-new">SELEZIONA L'IMMAGINE</span>
                  <span class="fileupload-exists">Change</span><%= f.file_field :image  %></span>
                  <a href="#" class="btn btn-default fileupload-exists" data-dismiss="fileupload">Remove</a>
                </div>
              </div>
          </div>
        </div>
      </div>

      <div class="row text-center">
        <div class="col-sm12">
          <button type="submit" class="btn btn-primary btn-lg">GENERA</button>
        </div>
      </div>     
    <% end %>
  </div>
</div>

<script type="text/javascript">

  var like_counter = false; 
  function add_like_fields(link, association, content) {
    if(!like_counter) {
      var new_id = new Date().getTime();
      var regexp = new RegExp("new_" + association, "g");
      $("#tmp-like-add").prepend(content.replace(regexp, new_id));
      like_counter = true;
    }
  }

  var play_counter = false; 
  function add_play_fields(link, association, content) {
    if(!play_counter) {
      var new_id = new Date().getTime();
      var regexp = new RegExp("new_" + association, "g");
      $("#tmp-play-add").prepend(content.replace(regexp, new_id));
      play_counter = true;
    }
  }

  function add_versus_fields(link, association, content) {
    var new_id = new Date().getTime();
    var regexp = new RegExp("new_" + association, "g");
    $("#tmp-versus-add").prepend(content.replace(regexp, new_id));
  }

  function add_quiz_fields(link, association, content) {
    var new_id = new Date().getTime();
    var regexp = new RegExp("new_" + association, "g");
    $("#tmp-quiz-add").prepend(content.replace(regexp, new_id));
  }

  function add_answer_fields(link, association, content) {
    var new_id = new Date().getTime();
    var regexp = new RegExp("new_" + association, "g");
    $(link).parent().parent().parent().find(".panel-body").prepend(content.replace(regexp, new_id));
  }

  function remove_quiz_fields(link) {
    $(link).parent().parent().parent().remove();
  }

  function remove_versus_fields(link) {
    $(link).parent().parent().parent().remove();
  }

  function remove_answer_versus_fields(link) {
    $(link).parent().parent().parent().parent().parent().remove();
  }

  function remove_answer_quiz_fields(link) {
    $(link).parent().parent().parent().remove();
  }

  function remove_like_fields(link) {
    $(link).parent().parent().parent().remove();
    like_counter = false;
  }

  function remove_play_fields(link) {
    $(link).parent().parent().parent().remove();
    play_counter = false;
  }

</script>