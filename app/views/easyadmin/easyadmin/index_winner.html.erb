<%= render partial: "/easyadmin/easyadmin/left_bar", locals: { page: "winner" } %>
 
  <div id="content">    
    
    <div id="content-header">
      <h1>Elenco VINCITORI</h1>
    </div> <!-- #content-header --> 

      <div id="content-container">

      <% if flash[:notice] %>
        <div class="row">
          <div class="col-md-12">         
              <div class="row">
                <div class="col-lg-12">
                  <div class="alert alert-success"><%= flash[:notice] %></div>
                </div>
              </div>
            
          </div>
        </div>
      <% end %>

    <div class="row cta-to-show">
      <div class="col-md-12"> 
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Cognome</th>
              <th>Email</th>
              <th>Premio</th>
              <th>Giorno di vincita</th>
              <th>Azioni</th>
            </tr>
          </thead>
          <% @playticket_events.each do |playticket_event| %>
            <tr>
              <td><%= playticket_event.user.first_name %></td>
              <td><%= playticket_event.user.last_name %></td>
              <td><%= playticket_event.user.email %></td>
              <td><%= playticket_event.contest_periodicity.title %></td>
              <td><%= playticket_event.instantwin.time_to_win_start.strftime("%d/%m/%Y") %></td>
              <td><button class="btn btn-xs btn-primary" id="playticket-event-<%= playticket_event.id %>" onclick="send_email_to_winner(<%= playticket_event.id %>)">AVVISA</button></td>
            </tr>
          <% end %>
        </table>
      </div>
    </div>

    <div class="row cta-to-show">
      <div class="col-md-12">
        <%= render partial: "pagination" %>
      </div>
    </div>

  </div>
</div>

<script type="text/javascript">
  function send_email_to_winner(playticket_event_id) {
    $("#playticket-event-" + playticket_event_id).attr('disabled', true);
    $("#playticket-event-" + playticket_event_id).html('...');
    $.ajax({
          type: "POST",
          url: "/easyadmin/winner/send_email_to_winner",
          data: { playticket_event_id: playticket_event_id },
          beforeSend: function(jqXHR, settings) {
            jqXHR.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'));
          },
          success: function(data) {
            $("#playticket-event-" + playticket_event_id).attr('disabled', false);
            $("#playticket-event-" + playticket_event_id).html('AVVISA');
          } // success AJAX
      });
  }
</script>
