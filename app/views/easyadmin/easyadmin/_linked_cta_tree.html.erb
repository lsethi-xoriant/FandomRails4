<div id="treeModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="treeModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <!--<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>-->
        <h4 class="modal-title" id="treeModalLabel">Call to action collegate a '<%= @current_cta.title %>'</h4>
      </div>

      <div class="modal-body">

        <div id="trees">
          <%= build_html_jstree(build_tree(@current_cta), @current_cta.id) %> 
        </div>

        <!-- <hr/> -->

        <div id="event_result" class="text-center"></div>

      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">Chiudi</button>
      </div>

    </div> <!-- /.modal-content -->
  </div> <!-- /.modal-dialog -->
</div>

<script type="text/javascript">

  $('.tree').bind('loaded.jstree', function (e, data) {
    data.instance.open_all();
  });

  $('.tree').on('select_node.jstree', function (e, data) {
    var i, j, r = [];
    for(i = 0, j = data.selected.length; i < j; i++) {
      r.push(data.instance.get_node(data.selected[i]).text);
    }
    if (r.length == 1)
      $('#event_result').html('<hr/><a href="/easyadmin/cta/show/' + r[0] + '"><button type="button" class="btn btn-primary">Vai allo step selezionato</button></a>');
    else
      $('#event_result').html('');
  });

  $('.tree').jstree();

</script>