<%= render partial: "/easyadmin/easyadmin/left_bar", locals: { page: "tags" } %>
 
  <div id="content">    
    
    <div id="content-header">
      <h1>Elenco TAG</h1>
    </div> <!-- #content-header --> 

      <div id="content-container">

      <% if flash[:notice] %>
        <div class="row">
          <div class="col-md-12">         
              <div class="row">
                <div class="col-lg-12">
                  <div class="alert alert-success"><%= flash[:notice] %></div>
                </div>
              </div>
            
          </div>
        </div>
      <% end %>
      
      <div class="row text-right">
        <div class="col-md-12">
          <a href="/easyadmin/tag/new"><button type="button" class="btn btn-primary">NUOVO</button></a>
        </div>
      </div>

    <div class="row">
    <div class="col-md-3">
        <label>Filtra per TITOLO</label><input class="form-control" type="text" onkeyup="updateFilter(0, this);">
      </div>
      <div class="col-md-3">
        <label>Filtra per DESCRIZIONE</label><input class="form-control" type="text" onkeyup="updateFilter(1, this);">
      </div>
      <div class="col-md-3">
        <label>Filtra per TAG</label><input class="form-control" type="text" onkeyup="updateFilter(2, this);">
      </div>
    </div>

    <div id="tag-to-filter" class="row hidden">
      <div class="col-md-12"> 
        <table id="tags-from-ajax-request" class="table table-striped">
        </table>
      </div>
    </div>

    <div class="row tag-to-show">
      <div class="col-md-12"> 
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Titolo</th>
              <th>Descrizione</th>
              <th>Inizio validità</th>
              <th>Fine validità</th>
              <th>Tag</th>
              <th>Locked</th>
              <th>Metadati</th>
              <th>Azioni</th>
            </tr>
          </thead>
          <% @tags.each do |tag| %>
            <%= render partial: "/easyadmin/tag/tags_index_row", locals: { tag: tag } %>
          <% end %>
        </table>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">

  var ajax_in_progress = false;
  var filters = ["", "", ""];

  function updateFilter(n, filter) {
    filters[n] = $(filter).val();
    updateTagsToFilter(filters);
  }

  function updateTagsToFilter(filters) {
    if(filters[0] == "" && filters[1] == "" && filters[2] == "") {

      $(".tag-to-show").removeClass("hidden");
      $("#tag-to-filter").addClass("hidden");

    } else {

      $(".tag-to-show").addClass("hidden");
      $("#tag-to-filter").removeClass("hidden");

        if(!ajax_in_progress) {

        ajax_in_progress = true;
        var urlString = "";

        var filter0 = "nil_title_filter";
        var filter1 = "nil_description_filter";
        var filter2 = "nil_tag_filter";

        if(filters[0] != "")
          filter0 = filters[0];
        if(filters[1] != "")
          filter1 = filters[1];
        if(filters[2] != "")
          filter2 = filters[2];

        urlString = "tag/filter/" + filter0 + "/" + filter1 + "/" + filter2;

        $.ajax({
              type: "GET",
              url: urlString,
              beforeSend: function(jqXHR, settings) {
                  jqXHR.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'));
              },
              success: function(data) {

                $("#tags-from-ajax-request").html("");

                $("#tags-from-ajax-request").html(data);

                html =
                      "<thead>" +
                        "<tr>" +
                          "<th>Nome</th>" +
                          "<th>Titolo</th>" +
                          "<th>Descrizione</th>" +
                          "<th>Inizio validità</th>" +
                          "<th>Fine validità</th>" +
                          "<th>Tag</th>" +
                          "<th>Locked</th>" +
                          "<th>Metadati</th>" +
                          "<th>Azioni</th>" +
                        "</tr>" +
                      "</thead>";

                $("#tags-from-ajax-request").prepend(html);

                ajax_in_progress = false;

              },
              error: function(data) {
                ajax_in_progress = false;
              }
          });
        }
        else
          updateTagsToFilter(filters);
    }
  }

</script>