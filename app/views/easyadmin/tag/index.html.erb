<%= render partial: "/easyadmin/easyadmin/left_bar", locals: { page: "tags" } %>
 
  <div id="content">    
    
    <div id="content-header">
      <h1>Elenco TAG</h1>
    </div> <!-- #content-header --> 

      <div id="content-container">

      <% if flash[:notice] %>
        <div class="row">
          <div class="col-md-12">         
              <div class="row">
                <div class="col-lg-12">
                  <div class="alert alert-success"><%= flash[:notice] %></div>
                </div>
              </div>
            
          </div>
        </div>
      <% end %>
      
      <div class="row text-right">
        <div class="col-md-12">
          <a href="/easyadmin/tag/new"><button type="button" class="btn btn-primary">NUOVO</button></a>
        </div>
      </div>

    <div class="row">
      <div class="col-md-3">
        <label>Filtra per DESCRIZIONE</label><input class="form-control" type="text" onkeyup="updateFilter(this);">
      </div>
    </div>

    <div id="tag-to-filter" class="row hidden">
      <div class="col-md-12"> 
        <table id="tags-from-ajax-request" class="table table-striped">
        </table>
      </div>
    </div>

    <div class="row tag-to-show">
      <div class="col-md-12"> 
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Titolo</th>
              <th>Descrizione</th>
              <th>Inizio validità</th>
              <th>Fine validità</th>
              <th>Locked</th>
              <th>Metadati</th>
              <th>Azioni</th>
            </tr>
          </thead>
          <% @tags.each do |tag| %>
            <%= render partial: "/easyadmin/easyadmin/tags_index_row", locals: { tag: tag } %>
          <% end %>
        </table>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">

  var ajax_in_progress = false;
  var filterString = "";

  function updateFilter(filter) {
    filterString = $(filter).val();
    updateTagsToFilter(filterString);
  }

  function updateTagsToFilter(filterString) {
    if(filterString == "") {

      $(".tag-to-show").removeClass("hidden");
      $("#tag-to-filter").addClass("hidden");

    } else {

      $(".tag-to-show").addClass("hidden");
      $("#tag-to-filter").removeClass("hidden");

        if(!ajax_in_progress) {

        ajax_in_progress = true;

        $.ajax({
              type: "GET",
              url: "tag/filter/" + filterString,
              beforeSend: function(jqXHR, settings) {
                  jqXHR.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'));
              },
              success: function(data) {

                $("#tags-from-ajax-request").html("");

                $("#tags-from-ajax-request").html(data);

                html =
                      "<thead>" +
                        "<tr>" +
                          "<th>Nome</th>" +
                          "<th>Titolo</th>" +
                          "<th>Descrizione</th>" +
                          "<th>Inizio validità</th>" +
                          "<th>Fine validità</th>" +
                          "<th>Locked</th>" +
                          "<th>Metadati</th>" +
                          "<th>Azioni</th>" +
                        "</tr>" +
                      "</thead>";

                $("#tags-from-ajax-request").prepend(html);

                ajax_in_progress = false;

              },
              error: function(data) {
                ajax_in_progress = false;
              }
          });
        }
        else
          updateTagsToFilter(filterString);
    }
  }

</script>