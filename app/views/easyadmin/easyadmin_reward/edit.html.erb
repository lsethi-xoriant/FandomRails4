<%= render partial: "/easyadmin/easyadmin/left_bar", locals: { page: "prize" } %>
    
<div id="content">    

  <div id="content-header">
    <h1>Nuovo premio</h1>
  </div> <!-- #content-header --> 

  <div id="content-container">

    <div class="row">
      <div class="col-md-12"> 
        <% if @reward.errors.any? %>
          <div class="row">
            <div class="col-lg-12">
              <div class="alert alert-danger">
                <p>Errori nel salvataggio dell'utente:</p>
                <p>
                  <ul>
                    <% @reward.errors.full_messages.each do |msg| %>
                      <li><%= msg %></li>
                    <% end %>
                  </ul>
                </p>
              </div>
            </div>
          </div>
        <% elsif flash[:notice] %>
          <div class="row">
            <div class="col-lg-12">
              <div class="alert alert-success"><%= flash[:notice] %></div>
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <h3>Dati premio</h3>
    <hr/>
    
    <%= form_for @reward, url: { action: "update" }, multipart: true do |f| %>
      <%= hidden_field_tag :id, @reward.id %>
      <div class="row">
        <div class="col-lg-6">
          <div class="form-group">
              <label class="text-input">Titolo</label>
              <%= f.text_field :title, :class => "form-control" %>
          </div>
          <div class="form-group">
              <label class="text-input">Descrizione breve</label>
              <%= f.text_field :short_description, :class => "form-control" %>
          </div>
          <div class="form-group">
              <label class="text-input">Testo pulsante</label>
              <%= f.text_field :button_label, :class => "form-control" %>
          </div>
          <div class="form-group">
              <label class="text-input">Costo premio</label>
              <%= f.text_field :cost, :class => "form-control" %>
          </div>
          <div class="form-group">
              <label class="text-input">Tipo currency</label>
              <% date_array = @currency_rewards.map { |currency| [currency.title, currency.id] } %>
              <% date_array.unshift ["", ""] %>
              <%= select_tag :currency_id, options_for_select(date_array), :class => "form-control" %>
          </div>
          <div class="form-group">
            <label class="text-input">Tipologia di contenuto</label>
              <%= f.select(:media_type, [["DIGITALE", "DIGITALE"], ["FISICO", "FISICO"]], {}, { :class => "form-control" }) %>
          </div>
          <div class="form-group">
              <label class="text-input">Video URL</label>
              <%= f.text_field :video_url, :class => "form-control" %>
          </div>
          <div class="form-group">
              <label class="text-input">File allegato</label>
              <%= f.file_field :media_file  %>
          </div>
          <div class="form-group">
          	<%= f.check_box :spendable %> Spendibile
          </div>
          <div class="form-group">
          	<%= f.check_box :countable %> Conteggiabile
          </div>
          <div class="form-group">
          	<%= f.check_box :numeric_display %> Visualizzazione numerica
          </div>

        </div>

        <div class="col-lg-6 text-center">
          <div class="form-group">
              <label class="text-input">Immagine principale</label>
              <div class="fileupload fileupload-new" data-provides="fileupload">
                <div class="fileupload-preview thumbnail" style="width: 400px; height: 300px; line-height: 20px;">
                	<img src="<%= @reward.main_image.url %>">
                </div>
                <div>
                  <span class="btn btn-default btn-file"><span class="fileupload-new">SELEZIONA L'IMMAGINE</span>
                  <span class="fileupload-exists">Change</span><%= f.file_field :main_image  %></span>
                  <a href="#" class="btn btn-default fileupload-exists" data-dismiss="fileupload">Remove</a>
                </div>
              </div>
          </div>
          <div class="form-group">
            <label class="text-input">Immagine reward acquisito</label>
            <div class="fileupload fileupload-new" data-provides="fileupload">
              <div class="fileupload-preview thumbnail" style="width: 100px; height: 100px; line-height: 20px;">
              	<img src="<%= @reward.preview_image.url %>">
              </div>
              <div>
                <span class="btn btn-default btn-file"><span class="fileupload-new">SELEZIONA L'IMMAGINE</span>
                <span class="fileupload-exists">Change</span><%= f.file_field :preview_image  %></span>
                <a href="#" class="btn btn-default fileupload-exists" data-dismiss="fileupload">Remove</a>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label class="text-input">Immagine reward non acquisito</label>
            <div class="fileupload fileupload-new" data-provides="fileupload">
              <div class="fileupload-preview thumbnail" style="width: 100px; height: 100px; line-height: 20px;">
              	<img src="<%= @reward.not_awarded_image.url %>">
              </div>
              <div>
                <span class="btn btn-default btn-file"><span class="fileupload-new">SELEZIONA L'IMMAGINE</span>
                <span class="fileupload-exists">Change</span><%= f.file_field :not_awarded_image  %></span>
                <a href="#" class="btn btn-default fileupload-exists" data-dismiss="fileupload">Remove</a>
              </div>
            </div>
        </div>
          <div class="form-group">
            <label class="text-input">Immagine reward perso</label>
            <div class="fileupload fileupload-new" data-provides="fileupload">
              <div class="fileupload-preview thumbnail" style="width: 100px; height: 100px; line-height: 20px;"></div>
              <div>
                <span class="btn btn-default btn-file"><span class="fileupload-new">SELEZIONA L'IMMAGINE</span>
                <span class="fileupload-exists">Change</span><%= f.file_field :not_winnable_image  %></span>
                <a href="#" class="btn btn-default fileupload-exists" data-dismiss="fileupload">Remove</a>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <h3>DESCRIZIONE ESTESA</h3>
      <hr />
      <div class="row">
      	<div class="col-sm-12">
      		<div class="form-group">
              <%= f.text_area :long_description, :class => "form-control" %>
          	</div>
          </div>
      </div>

      <h3>TAGGING</h3>
      <hr />

      <div class="row">
        <div class="col-sm-6">
            <%= text_field_tag :tag_list, @tag_list, { id: "s2_tokenization", class: "form-control" } %>
            <span class="help-block">Per separare i TAG digita virgola</span>
        </div>
      </div>

      <h3>Data inizio validità</h3>
      <hr/>

      <div class="row">
        <div class="col-lg-6">
          <div class="form-group">
            <label class="text-input">Giorno</label>
            <div id="calltoaction_activation_date_div" class="input-group date" data-auto-close="true" data-date-autoclose="true" data-date-format="yyyy-mm-dd">
              <%= f.text_field :valid_from_date, :class => "form-control", value: @reward && @reward.valid_from ? @reward.valid_from.strftime("%Y-%m-%d") : "" %>
              <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
            </div>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="form-group">
            <label class="text-input">Ora</label>
            <div id="dp-ex-3" class="input-group bootstrap-timepicker">
              <%= f.text_field :valid_from_time, :class => "form-control", value: @reward && @reward.valid_from ? @reward.valid_from.strftime("%H:%M") : DateTime.now.strftime("%H:%M") %>
              <span class="input-group-addon"><i class="fa fa-clock-o"></i></span>
            </div>
          </div>
        </div>
      </div>
      
      <h3>Data fine validità</h3>
      <hr/>

      <div class="row">
        <div class="col-lg-6">
          <div class="form-group">
            <label class="text-input">Giorno</label>
            <div id="calltoaction_activation_date_div" class="input-group date" data-auto-close="true" data-date-autoclose="true" data-date-format="yyyy-mm-dd">
              <%= f.text_field :valid_to_date, :class => "form-control", value: @reward && @reward.valid_to ? @reward.valid_to.strftime("%Y-%m-%d") : "" %>
              <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
            </div>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="form-group">
            <label class="text-input">Ora</label>
            <div id="dp-ex-3" class="input-group bootstrap-timepicker">
              <%= f.text_field :valid_to_time, :class => "form-control", value: @reward && @reward.valid_to ? @reward.valid_to.strftime("%H:%M") : "" %>
              <span class="input-group-addon"><i class="fa fa-clock-o"></i></span>
            </div>
          </div>
        </div>
      </div>

      <div class="row text-center">
        <div class="col-sm12">
          <button type="submit" class="btn btn-primary btn-lg">CREA</button>
        </div>
      </div>     
    <% end %>
  </div>
</div>

<script type="text/javascript">
  tl = <%= raw(Tag.select("name").map(&:name).to_json) %>;
  $(document).ready(function() {
    $('#s2_tokenization').select2({
      placeholder: "",
      tags: tl,
      tokenSeparators: [","]
    })
  });
</script>